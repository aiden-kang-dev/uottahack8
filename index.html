<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule Helper</title>
    <style>
        body {
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: black;
        color: white;

        }

        main {
        width: 90%;
        max-width: 1200px;
        text-align: center;
        }

        h1 {
        margin-bottom: 10px;
        }

        .timeline {
        width: 100%;
        height: 6px;
        background: #e0e0e0;
        margin: 40px 0;
        position: relative;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0,123,255,0.4);
        }

        .timeline::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 0;
        transform: translateY(-50%);
        width: 100%;
        height: 10px;
        background: linear-gradient(-45deg, lightcoral, skyblue, yellow, lightgreen);
        background-size: 400% 400%;
        animation: gradient 10s ease infinite;
        border-radius: 20px;
        z-index: -1;
        filter: blur(15px);
        }

        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        a {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }

        .event-node {
            display: inline-block;
            margin: 0 5px;
            padding: 5px 10px;
            background: #007bff;
            color: white;
            border-radius: 3px;
            font-size: 14px;
        }

        .dot {
        position: absolute;
        top: 50%;
        transform: translate(-50%, -50%);
        width: 12px;
        height: 12px;
        border-radius: 50%;
        z-index: 10;
        }


        .today-dot {
        background: #f7695f;
        width: 12px;
        height: 12px;
        z-index: 20;
        box-shadow: 0 0 8px rgba(254, 162, 162, 0.6);
        }
        .today-dot:hover {
        width: 18px;
        height: 18px;
        transition: all 0.2s ease;
        }

        .event-dot {
        background: #e0e0e0;
        box-shadow: 0 0 8px rgba(217, 212, 251, 0.6);
        }
        .event-dot:hover {
        width: 18px;
        height: 18px;
        transition: all 0.2s ease;
        }
        /* timeline title animation*/
        .tooltip {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            background: #1a1a2e;
            border: 1px solid #444;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            min-width: 120px;
        }
        .dot:hover .tooltip {
        opacity: 1;
        }

        .tooltip-item {
            padding: 4px 0;
            border-bottom: 1px solid #333;
        }

        .tooltip-item:last-child {
            border-bottom: none;
        }

        .tooltip-title {
            font-weight: 500;
        }

        .multi-event {
            background: #ffd700;
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.6);
        }

    </style>
  </head>

  <body>
    <main>
        <h1>Schedule Helper</h1>  
        <div class="timeline">
        </div>

        <a href="calendar.html">Grid View</a>
    </main>
    <script>
        function renderTimeline(){ // this function just prevent dots location error when window resize
            document.querySelectorAll('.dot').forEach(dot => dot.remove());

            // Load events from local storage and display only those within two weeks before and after today.
            let events = JSON.parse(localStorage.getItem('events')) || [];

            const today = new Date();
            today.setHours(0,0,0,0);

            const twoWeeksAgo = new Date(today); 
            twoWeeksAgo.setDate(today.getDate() - 14);

            const twoWeeksLater = new Date(today); 
            twoWeeksLater.setDate(today.getDate() + 14);

            let visibleEvents = [];
            for (let i = 0; i < events.length; i++) {
                let eventDate = new Date(events[i].start + 'T00:00:00');

                
                if (eventDate >= twoWeeksAgo && eventDate <= twoWeeksLater) {
                    visibleEvents.push(events[i]);
                }
            }

            const timeline = document.querySelector('.timeline');
            const timelineCenter = timeline.offsetWidth / 2;
            const dayInPixels = timeline.offsetWidth / 29;

            
            // events dots
            const eventsByDate = {};
            for (let event of visibleEvents) {
                const dateKey = event.start;
                if (!eventsByDate[dateKey]) {
                    eventsByDate[dateKey] = [];
                }
                eventsByDate[dateKey].push(event);
            }   //store the daily events in an object
            
            // TODAY dot
            const todayDot = document.createElement('div');
            todayDot.className = 'dot today-dot';
            todayDot.style.left = timelineCenter + 'px';

            const todayStr = today.toISOString().split('T')[0];
            const todayEvents = eventsByDate[todayStr];

            const todayTooltip = document.createElement('div');
            todayTooltip.className = 'tooltip';

            if (todayEvents) {
                todayTooltip.innerHTML = todayEvents.map(e => 
                    `<div class="tooltip-item">
                        <span class="tooltip-title">${e.title}</span>
                    </div>`
                ).join('');
                delete eventsByDate[todayStr];
            } else {
                todayTooltip.textContent = 'Today';
            }

            todayDot.appendChild(todayTooltip);
            timeline.appendChild(todayDot);

            for (let dateKey in eventsByDate) {
                const eventsOnDay = eventsByDate[dateKey];
                const dot = document.createElement('div');
                dot.className = 'dot event-dot';
                
            if (eventsOnDay.length > 1) {
                dot.classList.add('multi-event');
            }
                // schedule -> location on timeline
                let eventDate = new Date(dateKey + 'T00:00:00');
                let daysDiff = (eventDate - today) / (1000 * 60 * 60 * 24);
                let position = timelineCenter + (daysDiff * dayInPixels);
                dot.style.left = position + 'px';

                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip';
                tooltip.innerHTML = eventsOnDay.map(e => 
                    `<div class="tooltip-item">
                        <span class="tooltip-title">${e.title}</span>
                    </div>`
                ).join('');
                
                dot.appendChild(tooltip);
                timeline.appendChild(dot);
            }
        }
        renderTimeline();
        window.addEventListener('resize', renderTimeline); //rerender timeline on window resize
    </script>
  </body>
</html>